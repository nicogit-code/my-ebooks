{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _objectSpread from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import{useParams,Redirect}from'react-router-dom';import UserContext from'../auth/UserContext';import BookCard from'../books/BookCard';import axios from'axios';// import styles from './UserProfile.css';\nfunction UserLibrary(onDelete){var _useParams=useParams(),bookId=_useParams.bookId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),library=_useState4[0],setLibrary=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),deleteItem=_useState6[0],setDeleteItem=_useState6[1];var _useContext=useContext(UserContext),user=_useContext.user;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),redirect=_useState8[0],setRedirect=_useState8[1];function getUserLib(){return _getUserLib.apply(this,arguments);}function _getUserLib(){_getUserLib=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _library,promises,_books,booksWithLibId;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/userLibrary',{params:{userId:user.id}}).then(function(res){return res.data;});case 3:_library=_context.sent;promises=_library.map(function(lib){return axios('/books/'+lib.bookId).then(function(res){return res.data;});});console.warn({user:user,library:_library});_context.next=8;return Promise.all(promises);case 8:_books=_context.sent;booksWithLibId=_books.map(function(book,i){return _objectSpread({},book,{libId:_library[i].id});});setLibrary(_library);setBooks(booksWithLibId);_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.warn(_context.t0);case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return _getUserLib.apply(this,arguments);}useEffect(function(){getUserLib(bookId);},[]);function DeleteItem(_x){return _DeleteItem.apply(this,arguments);}function _DeleteItem(){_DeleteItem=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.delete('/users?userLibrary'+e.currentTarget.getAttribute('data-item-id'));case 2:res=_context2.sent;onDelete(e.currentTarget.getAttribute('data-item-id'));setDeleteItem(res.data);console.log(res);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return _DeleteItem.apply(this,arguments);}function handleDelete(_x2){return _handleDelete.apply(this,arguments);}function _handleDelete(){_handleDelete=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log('s-a sters cartea',id);_context3.prev=1;_context3.next=4;return axios.delete('/userLibrary/'+id,{data:id}).then(setLibrary(library.filter(function(book){return book.id!==Number(id);})));case 4:setTimeout(function(){return setDeleteItem(true);},200);_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](1);console.warn(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[1,7]]);}));return _handleDelete.apply(this,arguments);}if(books){return/*#__PURE__*/React.createElement(\"div\",{className:\"wrapper\"},deleteItem?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"alert alert-success\",role:\"alert\"},\"Modific\\u0103rile tale au fost salvate.\",redirect&&/*#__PURE__*/React.createElement(Redirect,{to:\"/profile\"}))):null,/*#__PURE__*/React.createElement(React.Fragment,null,books.map(function(book){return/*#__PURE__*/React.createElement(BookCard,{book:book,onDelete:handleDelete,key:book.id});})));}}export default UserLibrary;","map":{"version":3,"sources":["D:/ebooks-react-booksy/src/components/auth/UserLibrary.js"],"names":["React","useState","useEffect","useContext","useParams","Redirect","UserContext","BookCard","axios","UserLibrary","onDelete","bookId","books","setBooks","library","setLibrary","deleteItem","setDeleteItem","user","redirect","setRedirect","getUserLib","get","params","userId","id","then","res","data","promises","map","lib","console","warn","Promise","all","booksWithLibId","book","i","libId","DeleteItem","e","delete","currentTarget","getAttribute","log","handleDelete","filter","Number","setTimeout"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { useParams, Redirect } from 'react-router-dom';\r\nimport UserContext from '../auth/UserContext';\r\nimport BookCard from '../books/BookCard';\r\nimport axios from 'axios';\r\n\r\n// import styles from './UserProfile.css';\r\n\r\nfunction UserLibrary(onDelete) {\r\n\r\n    const { bookId } = useParams();\r\n    const [books, setBooks] = useState([]);\r\n    const [library, setLibrary] = useState([]);\r\n    const [ deleteItem, setDeleteItem ] = useState(null);\r\n    const { user } = useContext(UserContext);\r\n    const [redirect, setRedirect] = useState(false);\r\n\r\n    async function getUserLib() {\r\n\r\n        try {\r\n            const library = await axios.get('/userLibrary', { params: {userId: user.id} }).then(res => res.data);\r\n\r\n            const promises = library.map(lib => axios('/books/' + lib.bookId).then(res => res.data));\r\n            console.warn({user, library})\r\n            const books = await Promise.all(promises);\r\n            const booksWithLibId = books.map((book, i) => ({...book, libId: library[i].id}) );\r\n\r\n            setLibrary(library);\r\n            setBooks(booksWithLibId);\r\n        } catch(e) {\r\n            console.warn(e);\r\n        }\r\n    }\r\n\r\n    useEffect(() => { \r\n        getUserLib(bookId);\r\n\r\n    }, []);\r\n\r\n    async function DeleteItem(e) {\r\n        const res = await axios.delete('/users?userLibrary' + e.currentTarget.getAttribute('data-item-id'));\r\n        onDelete(e.currentTarget.getAttribute('data-item-id'));\r\n        setDeleteItem(res.data);\r\n\r\n        console.log(res);\r\n    }\r\n\r\n    async function handleDelete(id) {\r\n        \r\n        console.log('s-a sters cartea', id);\r\n        try{\r\n            await axios.delete('/userLibrary/' + id, { \r\n                data:id,\r\n        \r\n        }).then(setLibrary(library.filter(book => book.id !== Number(id)))); \r\n        setTimeout(() => setDeleteItem(true), 200);\r\n        } catch(e) {\r\n            console.warn(e)\r\n        }\r\n    }\r\n\r\n    if(books) {\r\n\r\n        return (\r\n            <div className=\"wrapper\">\r\n            {(deleteItem ?\r\n                <>\r\n                    <div className=\"alert alert-success\" role=\"alert\">\r\n                        Modificările tale au fost salvate.\r\n                        {redirect && <Redirect to='/profile'/> }\r\n                    </div>\r\n                    {/* <Redirect to='/profile'/> */}\r\n                </>\r\n                : null)}\r\n            <>\r\n                {books.map(book => (\r\n                    <BookCard book={ book } onDelete={handleDelete} key={ book.id } />\r\n                ))}\r\n            </>\r\n            </div>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nexport default UserLibrary;\r\n"]},"metadata":{},"sourceType":"module"}