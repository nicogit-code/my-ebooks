{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _defineProperty from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\ebooks-react-booksy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import{useParams,Redirect}from'react-router-dom';import axios from'axios';import UserContext from'../auth/UserContext';import styles from'./AddBookReview.module.css';export default function AddReview(){var _useParams=useParams(),bookId=_useParams.bookId;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),book=_useState2[0],setBook=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),redirect=_useState4[0],setRedirect=_useState4[1];var _useState5=useState({body:'',date:''}),_useState6=_slicedToArray(_useState5,2),review=_useState6[0],setReview=_useState6[1];var _useContext=useContext(UserContext),user=_useContext.user;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSuccessfull=_useState8[0],setSuccessfull=_useState8[1];function getBookById(_x){return _getBookById.apply(this,arguments);}function _getBookById(){_getBookById=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios('/books/'+id);case 3:res=_context.sent;console.log(res);setBook(res.data);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.warn(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return _getBookById.apply(this,arguments);}function handleSubmit(_x2){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();_context2.prev=1;_context2.next=4;return axios.post('/reviews/',_objectSpread({},review,{user:user.username,popularityId:Number(bookId)}));case 4:res=_context2.sent;setSuccessfull(true);setTimeout(function(){return setRedirect(true);},2000);console.log(res);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](1);console.warn(_context2.t0);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,10]]);}));return _handleSubmit.apply(this,arguments);}function handleInputChange(e){setReview(_objectSpread({},review,_defineProperty({},e.currentTarget.id,e.currentTarget.value)));}useEffect(function(){getBookById(bookId);},[bookId]);if(!book){return/*#__PURE__*/React.createElement(\"h2\",null,\"Loading...\");}if(!user){return/*#__PURE__*/React.createElement(\"p\",null,\"Pentru a adauga un review, trebuie sa fii autentificat\");}return/*#__PURE__*/React.createElement(\"div\",{className:styles.formBody},/*#__PURE__*/React.createElement(\"h2\",null,\"Ai citit-o? Scrie un review!\"),isSuccessfull?/*#__PURE__*/React.createElement(\"div\",{className:\"alert-success\"},/*#__PURE__*/React.createElement(\"div\",{className:\"alert\",role:\"alert\"},\"Review-ul tau a fost salvat.\"),redirect&&/*#__PURE__*/React.createElement(Redirect,{to:\"/\"}))// <button type=\"submit\" className={ styles.button }>Inapoi</button>\n:null,/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:styles.formGroup},/*#__PURE__*/React.createElement(\"input\",{onChange:handleInputChange,value:review.body,type:\"text\",className:styles.formControl,id:\"body\",placeholder:\"Scrie p\\u0103rerea ta\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{onChange:handleInputChange,value:review.date,className:'dateSelector',id:\"date\",placeholder:\"Selecteaz\\u0103 data\",type:\"date\"}),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:styles.button},\"Salveaz\\u0103\")))));}","map":{"version":3,"sources":["D:/ebooks-react-booksy/src/components/books/AddBookReview.js"],"names":["React","useState","useEffect","useContext","useParams","Redirect","axios","UserContext","styles","AddReview","bookId","book","setBook","redirect","setRedirect","body","date","review","setReview","user","isSuccessfull","setSuccessfull","getBookById","id","res","console","log","data","warn","handleSubmit","e","preventDefault","post","username","popularityId","Number","setTimeout","handleInputChange","currentTarget","value","formBody","formGroup","formControl","button"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { useParams, Redirect } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport UserContext from '../auth/UserContext';\r\n\r\nimport styles from './AddBookReview.module.css';\r\n\r\nexport default function AddReview() {\r\n    const { bookId } = useParams();\r\n    const [book, setBook] = useState(null);\r\n    \r\n    const [redirect, setRedirect] = useState(false);\r\n    const [review, setReview] = useState({\r\n        body: '',\r\n        date: ''\r\n    });\r\n    const { user } = useContext(UserContext);\r\n    const[isSuccessfull, setSuccessfull] = useState(false);\r\n\r\n\r\n    async function getBookById(id) {\r\n        try {\r\n            const res = await axios('/books/' + id);\r\n            console.log(res);\r\n            setBook(res.data);\r\n        } catch(e) {\r\n            console.warn(e);\r\n        }\r\n    }\r\n\r\n    async function handleSubmit(e) {\r\n        e.preventDefault();\r\n        try {\r\n\r\n            const res = await axios.post('/reviews/', {...review, user: user.username, popularityId: Number(bookId)});\r\n\r\n            setSuccessfull(true);\r\n            setTimeout(() => setRedirect(true), 2000);\r\n\r\n            console.log(res);\r\n        } catch(e) {\r\n            console.warn(e);\r\n        }\r\n    }\r\n\r\n    function handleInputChange(e) {\r\n        setReview({ ...review, [e.currentTarget.id]: e.currentTarget.value});\r\n    }\r\n    \r\n    useEffect(() => { \r\n        getBookById(bookId); \r\n    }, [bookId]);\r\n\r\n    if(!book) {\r\n        return <h2>Loading...</h2>;\r\n    }\r\n\r\n    if(!user) {\r\n    return <p>Pentru a adauga un review, trebuie sa fii autentificat</p>;\r\n    }\r\n    \r\n    return (\r\n        <div className={styles.formBody}>\r\n            <h2>Ai citit-o? Scrie un review!</h2>\r\n            {(isSuccessfull ?\r\n            <div className=\"alert-success\">\r\n                <div className=\"alert\" role=\"alert\">\r\n                    Review-ul tau a fost salvat.\r\n                </div>\r\n                {redirect && <Redirect to='/'/> }\r\n                \r\n            </div>\r\n                // <button type=\"submit\" className={ styles.button }>Inapoi</button>\r\n            : null)}\r\n\r\n\r\n\r\n            <form onSubmit={ handleSubmit }>\r\n                <div className={ styles.formGroup}>\r\n                    <input \r\n                        onChange={ handleInputChange }\r\n                        value={ review.body }\r\n                        type=\"text\" \r\n                        className={styles.formControl} \r\n                        id=\"body\" \r\n                        placeholder=\"Scrie părerea ta\"\r\n                    />\r\n                    <br/>\r\n                    <input \r\n                        onChange={ handleInputChange }\r\n                        value={ review.date }\r\n                        className={'dateSelector'} \r\n                        id=\"date\" \r\n                        placeholder=\"Selectează data\"\r\n                        type=\"date\"\r\n                    />\r\n                    <div>\r\n                        <button type=\"submit\" className={ styles.button }>Salvează</button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            \r\n        </div>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}