{"ast":null,"code":"var _jsxFileName = \"D:\\\\ebooks-react-booksy\\\\src\\\\components\\\\auth\\\\UserLibrary.js\";\nimport React, { useState, useEffect, useContext } from 'react';\nimport { useParams, Redirect } from 'react-router-dom';\nimport UserContext from '../auth/UserContext';\nimport BookCard from '../books/BookCard';\nimport axios from 'axios'; // import styles from './UserProfile.css';\n\nfunction UserLibrary(onDelete) {\n  const {\n    bookId\n  } = useParams();\n  const [books, setBooks] = useState([]);\n  const [library, setLibrary] = useState([]);\n  const [deleteItem, setDeleteItem] = useState(null);\n  const {\n    user\n  } = useContext(UserContext);\n  const [redirect, setRedirect] = useState(false);\n\n  async function getUserLib() {\n    try {\n      const library = await axios.get('/userLibrary', {\n        params: {\n          userId: user.id\n        }\n      }).then(res => res.data);\n      const promises = library.map(lib => axios('/books/' + lib.bookId).then(res => res.data));\n      console.warn({\n        user,\n        library\n      });\n      const books = await Promise.all(promises);\n      const booksWithLibId = books.map((book, i) => ({ ...book,\n        libId: library[i].id\n      }));\n      setLibrary(library);\n      setBooks(booksWithLibId);\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n\n  useEffect(() => {\n    getUserLib(bookId);\n  }, []);\n\n  async function DeleteItem(e) {\n    const res = await axios.delete('/users?userLibrary' + e.currentTarget.getAttribute('data-item-id'));\n    onDelete(e.currentTarget.getAttribute('data-item-id'));\n    setDeleteItem(res.data);\n    console.log(res);\n  }\n\n  async function handleDelete(id) {\n    console.log('s-a sters cartea', id);\n\n    try {\n      await axios.delete('/userLibrary/' + id, {\n        data: id\n      }).then(setLibrary(library.filter(book => book.id !== Number(id))));\n      setTimeout(() => setDeleteItem(true), 200);\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n\n  if (books) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 13\n      }\n    }, deleteItem ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"alert alert-success\",\n      role: \"alert\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 21\n      }\n    }, \"Modific\\u0103rile tale au fost salvate.\", redirect && /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/profile\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 38\n      }\n    }))) : null, /*#__PURE__*/React.createElement(React.Fragment, null, books.map(book => /*#__PURE__*/React.createElement(BookCard, {\n      book: book,\n      onDelete: handleDelete,\n      key: book.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 21\n      }\n    }))));\n  }\n}\n\nexport default UserLibrary;","map":{"version":3,"sources":["D:/ebooks-react-booksy/src/components/auth/UserLibrary.js"],"names":["React","useState","useEffect","useContext","useParams","Redirect","UserContext","BookCard","axios","UserLibrary","onDelete","bookId","books","setBooks","library","setLibrary","deleteItem","setDeleteItem","user","redirect","setRedirect","getUserLib","get","params","userId","id","then","res","data","promises","map","lib","console","warn","Promise","all","booksWithLibId","book","i","libId","e","DeleteItem","delete","currentTarget","getAttribute","log","handleDelete","filter","Number","setTimeout"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,UAArC,QAAuD,OAAvD;AACA,SAASC,SAAT,EAAoBC,QAApB,QAAoC,kBAApC;AACA,OAAOC,WAAP,MAAwB,qBAAxB;AACA,OAAOC,QAAP,MAAqB,mBAArB;AACA,OAAOC,KAAP,MAAkB,OAAlB,C,CAEA;;AAEA,SAASC,WAAT,CAAqBC,QAArB,EAA+B;AAE3B,QAAM;AAAEC,IAAAA;AAAF,MAAaP,SAAS,EAA5B;AACA,QAAM,CAACQ,KAAD,EAAQC,QAAR,IAAoBZ,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM,CAACa,OAAD,EAAUC,UAAV,IAAwBd,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAM,CAAEe,UAAF,EAAcC,aAAd,IAAgChB,QAAQ,CAAC,IAAD,CAA9C;AACA,QAAM;AAAEiB,IAAAA;AAAF,MAAWf,UAAU,CAACG,WAAD,CAA3B;AACA,QAAM,CAACa,QAAD,EAAWC,WAAX,IAA0BnB,QAAQ,CAAC,KAAD,CAAxC;;AAEA,iBAAeoB,UAAf,GAA4B;AAExB,QAAI;AACA,YAAMP,OAAO,GAAG,MAAMN,KAAK,CAACc,GAAN,CAAU,cAAV,EAA0B;AAAEC,QAAAA,MAAM,EAAE;AAACC,UAAAA,MAAM,EAAEN,IAAI,CAACO;AAAd;AAAV,OAA1B,EAAyDC,IAAzD,CAA8DC,GAAG,IAAIA,GAAG,CAACC,IAAzE,CAAtB;AAEA,YAAMC,QAAQ,GAAGf,OAAO,CAACgB,GAAR,CAAYC,GAAG,IAAIvB,KAAK,CAAC,YAAYuB,GAAG,CAACpB,MAAjB,CAAL,CAA8Be,IAA9B,CAAmCC,GAAG,IAAIA,GAAG,CAACC,IAA9C,CAAnB,CAAjB;AACAI,MAAAA,OAAO,CAACC,IAAR,CAAa;AAACf,QAAAA,IAAD;AAAOJ,QAAAA;AAAP,OAAb;AACA,YAAMF,KAAK,GAAG,MAAMsB,OAAO,CAACC,GAAR,CAAYN,QAAZ,CAApB;AACA,YAAMO,cAAc,GAAGxB,KAAK,CAACkB,GAAN,CAAU,CAACO,IAAD,EAAOC,CAAP,MAAc,EAAC,GAAGD,IAAJ;AAAUE,QAAAA,KAAK,EAAEzB,OAAO,CAACwB,CAAD,CAAP,CAAWb;AAA5B,OAAd,CAAV,CAAvB;AAEAV,MAAAA,UAAU,CAACD,OAAD,CAAV;AACAD,MAAAA,QAAQ,CAACuB,cAAD,CAAR;AACH,KAVD,CAUE,OAAMI,CAAN,EAAS;AACPR,MAAAA,OAAO,CAACC,IAAR,CAAaO,CAAb;AACH;AACJ;;AAEDtC,EAAAA,SAAS,CAAC,MAAM;AACZmB,IAAAA,UAAU,CAACV,MAAD,CAAV;AAEH,GAHQ,EAGN,EAHM,CAAT;;AAKA,iBAAe8B,UAAf,CAA0BD,CAA1B,EAA6B;AACzB,UAAMb,GAAG,GAAG,MAAMnB,KAAK,CAACkC,MAAN,CAAa,uBAAuBF,CAAC,CAACG,aAAF,CAAgBC,YAAhB,CAA6B,cAA7B,CAApC,CAAlB;AACAlC,IAAAA,QAAQ,CAAC8B,CAAC,CAACG,aAAF,CAAgBC,YAAhB,CAA6B,cAA7B,CAAD,CAAR;AACA3B,IAAAA,aAAa,CAACU,GAAG,CAACC,IAAL,CAAb;AAEAI,IAAAA,OAAO,CAACa,GAAR,CAAYlB,GAAZ;AACH;;AAED,iBAAemB,YAAf,CAA4BrB,EAA5B,EAAgC;AAE5BO,IAAAA,OAAO,CAACa,GAAR,CAAY,kBAAZ,EAAgCpB,EAAhC;;AACA,QAAG;AACC,YAAMjB,KAAK,CAACkC,MAAN,CAAa,kBAAkBjB,EAA/B,EAAmC;AACrCG,QAAAA,IAAI,EAACH;AADgC,OAAnC,EAGPC,IAHO,CAGFX,UAAU,CAACD,OAAO,CAACiC,MAAR,CAAeV,IAAI,IAAIA,IAAI,CAACZ,EAAL,KAAYuB,MAAM,CAACvB,EAAD,CAAzC,CAAD,CAHR,CAAN;AAIJwB,MAAAA,UAAU,CAAC,MAAMhC,aAAa,CAAC,IAAD,CAApB,EAA4B,GAA5B,CAAV;AACC,KAND,CAME,OAAMuB,CAAN,EAAS;AACPR,MAAAA,OAAO,CAACC,IAAR,CAAaO,CAAb;AACH;AACJ;;AAED,MAAG5B,KAAH,EAAU;AAEN,wBACI;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACEI,UAAU,gBACR,uDACI;AAAK,MAAA,SAAS,EAAC,qBAAf;AAAqC,MAAA,IAAI,EAAC,OAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kDAEKG,QAAQ,iBAAI,oBAAC,QAAD;AAAU,MAAA,EAAE,EAAC,UAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFjB,CADJ,CADQ,GAQN,IATN,eAUA,0CACKP,KAAK,CAACkB,GAAN,CAAUO,IAAI,iBACX,oBAAC,QAAD;AAAU,MAAA,IAAI,EAAGA,IAAjB;AAAwB,MAAA,QAAQ,EAAES,YAAlC;AAAgD,MAAA,GAAG,EAAGT,IAAI,CAACZ,EAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADH,CADL,CAVA,CADJ;AAkBH;AAEJ;;AAED,eAAehB,WAAf","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { useParams, Redirect } from 'react-router-dom';\r\nimport UserContext from '../auth/UserContext';\r\nimport BookCard from '../books/BookCard';\r\nimport axios from 'axios';\r\n\r\n// import styles from './UserProfile.css';\r\n\r\nfunction UserLibrary(onDelete) {\r\n\r\n    const { bookId } = useParams();\r\n    const [books, setBooks] = useState([]);\r\n    const [library, setLibrary] = useState([]);\r\n    const [ deleteItem, setDeleteItem ] = useState(null);\r\n    const { user } = useContext(UserContext);\r\n    const [redirect, setRedirect] = useState(false);\r\n\r\n    async function getUserLib() {\r\n\r\n        try {\r\n            const library = await axios.get('/userLibrary', { params: {userId: user.id} }).then(res => res.data);\r\n\r\n            const promises = library.map(lib => axios('/books/' + lib.bookId).then(res => res.data));\r\n            console.warn({user, library})\r\n            const books = await Promise.all(promises);\r\n            const booksWithLibId = books.map((book, i) => ({...book, libId: library[i].id}) );\r\n\r\n            setLibrary(library);\r\n            setBooks(booksWithLibId);\r\n        } catch(e) {\r\n            console.warn(e);\r\n        }\r\n    }\r\n\r\n    useEffect(() => { \r\n        getUserLib(bookId);\r\n\r\n    }, []);\r\n\r\n    async function DeleteItem(e) {\r\n        const res = await axios.delete('/users?userLibrary' + e.currentTarget.getAttribute('data-item-id'));\r\n        onDelete(e.currentTarget.getAttribute('data-item-id'));\r\n        setDeleteItem(res.data);\r\n\r\n        console.log(res);\r\n    }\r\n\r\n    async function handleDelete(id) {\r\n        \r\n        console.log('s-a sters cartea', id);\r\n        try{\r\n            await axios.delete('/userLibrary/' + id, { \r\n                data:id,\r\n        \r\n        }).then(setLibrary(library.filter(book => book.id !== Number(id)))); \r\n        setTimeout(() => setDeleteItem(true), 200);\r\n        } catch(e) {\r\n            console.warn(e)\r\n        }\r\n    }\r\n\r\n    if(books) {\r\n\r\n        return (\r\n            <div className=\"wrapper\">\r\n            {(deleteItem ?\r\n                <>\r\n                    <div className=\"alert alert-success\" role=\"alert\">\r\n                        ModificÄƒrile tale au fost salvate.\r\n                        {redirect && <Redirect to='/profile'/> }\r\n                    </div>\r\n                    {/* <Redirect to='/profile'/> */}\r\n                </>\r\n                : null)}\r\n            <>\r\n                {books.map(book => (\r\n                    <BookCard book={ book } onDelete={handleDelete} key={ book.id } />\r\n                ))}\r\n            </>\r\n            </div>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nexport default UserLibrary;\r\n"]},"metadata":{},"sourceType":"module"}